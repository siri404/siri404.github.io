<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Implement Array.prototype.reduce()</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .code-editor {
            font-family: 'Fira Code', monospace;
            background-color: #1E293B; /* slate-800 */
            color: #E2E8F0; /* slate-200 */
            border-color: #475569; /* slate-600 */
            tab-size: 4;
            -moz-tab-size: 4;
            -o-tab-size: 4;
        }
        .console-output {
             font-family: 'Fira Code', monospace;
        }
    </style>
</head>
<body class="bg-slate-900 text-slate-300">

    <div class="flex flex-col lg:flex-row h-screen">
        <!-- Left Panel: Problem Description & Results -->
        <div class="w-full lg:w-1/2 p-6 flex flex-col overflow-y-auto">
            <div class="flex-grow">
                <h1 class="text-2xl font-bold text-white mb-4">27. Implement Array.prototype.reduce()</h1>
                <div class="prose prose-invert max-w-none text-slate-300">
                    <p>The <code>reduce()</code> method executes a user-supplied "reducer" callback function on each element of the array, in order, passing in the return value from the calculation on the preceding element. The final result of running the reducer across all elements of the array is a single value.</p>
                    <p>Your task is to implement your own version of <code>Array.prototype.reduce</code>. Your function will be attached to <code>Array.prototype</code> for testing.</p>
                    <h3 class="text-white">Requirements:</h3>
                    <ul>
                        <li>Your function should be named <code>myReduce</code>.</li>
                        <li>It must accept two arguments: a <code>callback</code> function and an optional <code>initialValue</code>.</li>
                        <li>The <code>callback</code> function receives four arguments: <code>accumulator</code>, <code>currentValue</code>, <code>currentIndex</code>, and <code>array</code>.</li>
                        <li>If <code>initialValue</code> is provided, the <code>accumulator</code> starts with that value, and the iteration starts from the first element (index 0).</li>
                        <li>If <code>initialValue</code> is <strong>not</strong> provided:
                            <ul>
                                <li>The <code>accumulator</code> starts with the first element of the array.</li>
                                <li>The iteration starts from the second element (index 1).</li>
                                <li>If the array is empty and no <code>initialValue</code> is given, it must throw a <code>TypeError</code>.</li>
                            </ul>
                        </li>
                         <li>It should not use the built-in <code>Array.prototype.reduce</code> method.</li>
                    </ul>
                </div>
            </div>
            
            <!-- Console / Results -->
            <div class="mt-8 flex-shrink-0">
                 <h2 class="text-xl font-semibold text-white mb-2">Test Results</h2>
                 <div id="results-container" class="bg-slate-800 rounded-lg p-4 h-64 overflow-y-auto console-output">
                    <p class="text-slate-500">Click "Run Tests" to see the results.</p>
                 </div>
            </div>
        </div>

        <!-- Right Panel: Code Editor -->
        <div class="w-full lg:w-1/2 p-6 flex flex-col bg-slate-800/50 border-l border-slate-700">
            <h2 class="text-xl font-semibold text-white mb-2">Your Implementation</h2>
            <div class="flex-grow flex flex-col">
                 <textarea id="code-editor" class="w-full h-full p-4 rounded-lg code-editor focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 resize-none"></textarea>
            </div>
            <div class="mt-4 flex-shrink-0">
                 <button id="run-tests-btn" class="w-full bg-indigo-600 text-white font-bold py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-800 focus:ring-indigo-500 transition-colors duration-200">
                    Run Tests
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const codeEditor = document.getElementById('code-editor');
            const runTestsBtn = document.getElementById('run-tests-btn');
            const resultsContainer = document.getElementById('results-container');

            const initialCode = `/**
 * @param {Function} callback
 * @param {any} [initialValue]
 * @return {any}
 */
Array.prototype.myReduce = function(callback, initialValue) {
    // 'this' refers to the array
    const arr = this;
    const hasInitialValue = initialValue !== undefined;

    if (arr.length === 0 && !hasInitialValue) {
        throw new TypeError('Reduce of empty array with no initial value');
    }

    let accumulator = hasInitialValue ? initialValue : arr[0];
    let startIndex = hasInitialValue ? 0 : 1;

    for (let i = startIndex; i < arr.length; i++) {
        accumulator = callback(accumulator, arr[i], i, arr);
    }

    return accumulator;
};`;

            codeEditor.value = initialCode;

            const testCases = [
                {
                    description: 'Summing all values with an initial value',
                    array: [1, 2, 3, 4],
                    reducer: (acc, val) => acc + val,
                    initialValue: 0,
                    expected: 10
                },
                {
                    description: 'Summing without an initial value',
                    array: [1, 2, 3, 4],
                    reducer: (acc, val) => acc + val,
                    expected: 10
                },
                {
                    description: 'Flattening an array of arrays',
                    array: [[0, 1], [2, 3], [4, 5]],
                    reducer: (acc, val) => acc.concat(val),
                    initialValue: [],
                    expected: [0, 1, 2, 3, 4, 5]
                },
                {
                    description: 'Finding the maximum value',
                    array: [5, 1, 8, 3, 9, 4],
                    reducer: (acc, val) => Math.max(acc, val),
                    expected: 9
                },
                {
                    description: 'Throws TypeError on empty array with no initial value',
                    array: [],
                    reducer: (acc, val) => acc + val,
                    shouldThrow: true,
                    expectedError: 'TypeError'
                },
                {
                    description: 'Works with an empty array if initial value is provided',
                    array: [],
                    reducer: (acc, val) => acc + val,
                    initialValue: 100,
                    expected: 100
                },
                {
                    description: 'Correctly uses index and array arguments',
                    array: [10, 20],
                    reducer: (acc, val, index, arr) => acc + val + arr[index],
                    initialValue: 0,
                    expected: 60 // (0 + 10 + 10) + (20 + 20)
                }
            ];
            
            runTestsBtn.addEventListener('click', () => {
                resultsContainer.innerHTML = ''; // Clear previous results
                const userCode = codeEditor.value;

                try {
                    // Evaluate user's code to attach their myReduce to Array.prototype
                    // Using a new Function to avoid polluting the global scope directly
                    new Function(userCode)();
                    
                    if (typeof Array.prototype.myReduce !== 'function') {
                         throw new Error("`Array.prototype.myReduce` is not defined or is not a function.");
                    }

                } catch (e) {
                    renderError(`Syntax Error in Implementation: ${e.message}`);
                    return;
                }

                let allPassed = true;
                testCases.forEach((test, index) => {
                    let result, error;
                    let passed = false;

                    try {
                        // Use the user's implementation
                        result = test.hasOwnProperty('initialValue')
                            ? test.array.myReduce(test.reducer, test.initialValue)
                            : test.array.myReduce(test.reducer);
                        
                        if (test.shouldThrow) {
                           passed = false; // Should have thrown but didn't
                        } else {
                           passed = JSON.stringify(result) === JSON.stringify(test.expected);
                        }

                    } catch (e) {
                        error = e;
                        if (test.shouldThrow && e.name === test.expectedError) {
                            passed = true;
                        } else {
                            passed = false;
                        }
                    }
                    
                    if (!passed) allPassed = false;
                    renderTestCaseResult(test, passed, result, error, index + 1);
                });

                if(allPassed) {
                    const successMessage = document.createElement('div');
                    successMessage.className = 'text-green-400 font-bold text-lg mt-4';
                    successMessage.textContent = 'Congratulations! All tests passed!';
                    resultsContainer.prepend(successMessage);
                }

                // Clean up the prototype after tests
                delete Array.prototype.myReduce;
            });

            const renderError = (message) => {
                 resultsContainer.innerHTML = `<div class="p-2 rounded-md bg-red-900/40 text-red-300">
                    <p class="font-bold">Error:</p>
                    <p>${message}</p>
                 </div>`;
            };

            const renderTestCaseResult = (test, passed, result, error, caseNum) => {
                const resultEl = document.createElement('div');
                resultEl.className = `p-2 rounded-md mb-2 ${passed ? 'bg-green-900/40' : 'bg-red-900/40'}`;
                
                let details = '';
                if (!passed) {
                    if (test.shouldThrow && !error) {
                        details = `Expected to throw ${test.expectedError}, but returned: <pre class="inline">${JSON.stringify(result)}</pre>`;
                    } else if (error) {
                        details = `Threw unexpected error: ${error.name}: ${error.message}`;
                    } else {
                        details = `Expected: <pre class="inline">${JSON.stringify(test.expected)}</pre><br>Received: <pre class="inline">${JSON.stringify(result)}</pre>`;
                    }
                }

                resultEl.innerHTML = `
                    <div class="font-bold ${passed ? 'text-green-400' : 'text-red-300'}">
                        Case ${caseNum}: ${test.description} - ${passed ? 'Passed' : 'Failed'}
                    </div>
                    ${!passed ? `<div class="mt-1 text-xs text-slate-300">${details}</div>` : ''}
                `;
                resultsContainer.appendChild(resultEl);
            };
        });
    </script>

</body>
</html>
